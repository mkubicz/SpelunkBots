#include "stdafx.h"
#include "ExploitDisarmAction.h"

ExploitDisarmAction::ExploitDisarmAction(std::shared_ptr<IBot> const & bot, DIRECTIONX dir)
	: IMovementAction(bot)
{
	_actionType = EXPLOITDISARM;
	_directionX = dir;
}

ordersStruct ExploitDisarmAction::GetOrders()
{
	ordersStruct orders;
	int playerPosX = (int)_bot->GetPlayerPositionX();

	if (!_actionInProgress)
	{
		int xNode = (int)_bot->GetPlayerPositionXNode();// +(throwDir.x == xRIGHT ? 7 : -7);
		_targetNode =
			Coords(
				xNode*PIXELS_IN_NODE + (_directionX == xRIGHT ? 18 : -2),
				_bot->GetPlayerPositionY(),
				PIXEL);

		_actionInProgress = true;
	}

	if (playerPosX != _targetNode.GetXpixel())
	{
		if (!_bot->IsHoldingItem()) orders.itemp = true;

		if (playerPosX > _targetNode.GetXpixel()) orders.leftReleased = true;
		else if (playerPosX < _targetNode.GetXpixel()) orders.rightReleased = true;
	}
	else
	{
		if (!_bot->IsHoldingItem()) _actionDone = true;
	}


	return orders;
}